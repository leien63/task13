var common={TodoFilter:"",ENTER_KEY:13};
;var TodoModel=Backbone.Model.extend({defaults:{title:"",completed:!1},toggle:function(){this.save({completed:!this.get("completed")})}});
;var TodosCollection=Backbone.Collection.extend({model:TodoModel,localStorage:new Backbone.LocalStorage("todos-backbone"),completed:function(){return this.filter(function(o){return o.get("completed")})},remaining:function(){return this.without.apply(this,this.completed())},nextOrder:function(){return this.length?this.last().get("order")+1:1},comparator:function(o){return o.get("order")}}),todos=new TodosCollection;
;var TodoView=Backbone.View.extend({tagName:"li",template:function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="view">\n    <input class="toggle" type="checkbox" '+(null==(__t=completed?"checked":"")?"":__t)+'>\n    <label class="icon_'+(null==(__t=Math.ceil(5*Math.random()))?"":_.escape(__t))+'">'+(null==(__t=title)?"":_.escape(__t))+'</label>\n    <button class="destroy"></button>\n</div>\n<input class="edit" value="'+(null==(__t=title)?"":_.escape(__t))+'">';return __p},events:{"click .toggle":"toggleCompleted","dblclick label":"edit","click .destroy":"clear","keypress .edit":"updateOnEnter","blur .edit":"close"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"visible",this.toggleVisible)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$el.toggleClass("completed",this.model.get("completed")),this.toggleVisible(),this.$input=this.$(".edit"),this},toggleVisible:function(){this.$el.toggleClass("hidden",this.isHidden())},isHidden:function(){var t=this.model.get("completed");return!t&&"completed"===common.TodoFilter||t&&"active"===common.TodoFilter},toggleCompleted:function(){this.model.toggle()},edit:function(){this.$el.addClass("editing"),this.$input.focus()},close:function(){var t=this.$input.val().trim();t?this.model.save({title:t}):this.clear(),this.$el.removeClass("editing")},updateOnEnter:function(t){t.which===common.ENTER_KEY&&this.close()},clear:function(){this.model.destroy()}});
;var AppView=Backbone.View.extend({el:"#todoapp",statsTemplate:function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<span id="todo-count"><strong>'+(null==(__t=remaining)?"":__t)+"</strong> "+(null==(__t=1===remaining?"item":"items")?"":__t)+' left</span>\n<ul id="filters">\n    <li>\n        <a class="selected" href="#/">All</a>\n    </li>\n    <li>\n        <a href="#/active">Active</a>\n    </li>\n    <li>\n        <a href="#/completed">Completed</a>\n    </li>\n</ul>\n',completed&&(__p+='\n<button id="clear-completed">Clear completed ('+(null==(__t=completed)?"":__t)+")</button>\n"),__p+="";return __p},events:{"keypress #new-todo":"createOnEnter","click #clear-completed":"clearCompleted","click #toggle-all":"toggleAllComplete"},initialize:function(){this.allCheckbox=this.$("#toggle-all")[0],this.$input=this.$("#new-todo"),this.$footer=this.$("#footer"),this.$main=this.$("#main"),this.listenTo(todos,"add",this.addOne),this.listenTo(todos,"reset",this.addAll),this.listenTo(todos,"change:completed",this.filterOne),this.listenTo(todos,"filter",this.filterAll),this.listenTo(todos,"all",this.render),todos.fetch()},render:function(){var t=todos.completed().length,e=todos.remaining().length;todos.length?(this.$main.show(),this.$footer.show(),this.$footer.html(this.statsTemplate({completed:t,remaining:e})),this.$("#filters li a").removeClass("selected").filter('[href="#/'+(common.TodoFilter||"")+'"]').addClass("selected")):(this.$main.hide(),this.$footer.hide()),this.allCheckbox.checked=!e},addOne:function(t){var e=new TodoView({model:t});$("#todo-list").append(e.render().el)},addAll:function(){this.$("#todo-list").html(""),todos.each(this.addOne,this)},filterOne:function(t){t.trigger("visible")},filterAll:function(){todos.each(this.filterOne,this)},newAttributes:function(){return{title:this.$input.val().trim(),order:todos.nextOrder(),completed:!1}},createOnEnter:function(t){t.which===common.ENTER_KEY&&this.$input.val().trim()&&(todos.create(this.newAttributes()),this.$input.val(""))},clearCompleted:function(){return _.invoke(todos.completed(),"destroy"),!1},toggleAllComplete:function(){var t=this.allCheckbox.checked;todos.each(function(e){e.save({completed:t})})}});
;var Workspace=Backbone.Router.extend({routes:{"*filter":"setFilter"},setFilter:function(e){common.TodoFilter=e&&e.trim()||"",todos.trigger("filter")}});
;$(document).ready(function(){new Workspace,Backbone.history.start(),new AppView});